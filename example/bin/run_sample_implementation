#!/usr/bin/php

<?php
include_once dirname(dirname(__DIR__)) . '/src/PHPUnitDistributed/phpunitdistributed_common.php';

use PHPUnitDistributed\Util\Witness;
use PHPUnitDistributed\Util\Shell;
use PHPUnitDistributed\PHPUnit\Configuration;
use PHPUnitDistributed\PHPUnit\RunDistributedMaster;
use PHPUnitDistributed\TestDivisionStrategy\TestCount;

$app_dir = '/your/app/dir/goes/here/';

// The hostnames of the slaves
$slaves = array(
	'slave_host_01.your-network.net',
	'slave_host_02.your-network.net',
	'slave_host_03.your-network.net',
);

$shell = new Shell();
$witness = new Witness();

// Run PHPUnit through the cluster! The 'junit_result_output_path' refers to the
// location on the master.
$config = new Configuration(
	array(
		'app_directory' => $app_dir,
		'junit_result_output_path' => '/var/out/result.xml',
		'test_directories' => array($app_dir . 'test'),
		'bootstrap_file' => $app_dir . 'test/setup.php', 	// this is app-relative, so maps to /your/app/dir/goes/here/test/setup.php
		'verbose' => true,
	),
	$witness
);
$runner = new RunDistributedMaster(
        $config,
        $slaves,
        new TestCount(),
        $shell,
		$witness,
        array('.git*', 'conf/conf_set.conf'),
        true
);
$runner->run();